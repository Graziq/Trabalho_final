name: Deploy Prefect Flow

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: windows-latest # Alterado para Windows

    steps:
      - name: ğŸ” Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: ğŸ Instalar Python 3.12.5
        uses: actions/setup-python@v4
        with:
          python-version: "3.12.5"

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          python -m pip install -U pip
          python -m pip install -r requirements.txt
          python -m pip install "prefect==2.16.4" pandapower networkx pandas numpy
          # Configura PYTHONPATH para Windows (PowerShell)
          $env:PYTHONPATH="$env:PYTHONPATH;$(Get-Location)\src"
        
        shell: powershell

      - name: ğŸ”— Configurar conexÃ£o com Prefect Server remoto
        run: |
          # Define a PREFECT_API_URL usando a sintaxe do PowerShell
          prefect config set PREFECT_API_URL="${{ secrets.PREFECT_SERVER_URL }}/api"
          prefect profile ls

        shell: powershell # Garante PowerShell para este passo tambÃ©m

      - name: ğŸš€ Deploy do Flow
        run: |
          prefect deploy
        shell: powershell
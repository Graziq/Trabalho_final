name: Executar Análise e Visualização

on:
  workflow_run:
    workflows: ["Deploy Prefect Flow"]
    types: [completed]

jobs:
  process-data:
    runs-on: ubuntu-latest
    env:
      DOCKER_IMAGE: visualizacao-impacto
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Baixar dados do Prefect
        uses: actions/download-artifact@v3
        with:
          name: tensao_barras_nao_criticos_ieee30.csv
          path: simulacao_resultados/
      
      - name: Construir imagem
        run: docker build --target visualization -t $DOCKER_IMAGE .
      
      - name: Executar container
        run: |
          docker run -d \
            -p 8050:8050 \
            -v $(pwd)/simulacao_resultados:/app/simulacao_resultados \
            $DOCKER_IMAGE
          
          echo "Dashboard disponível em: http://localhost:8050" >> $GITHUB_STEP_SUMMARY